import socket
import base64

sckt = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
sckt.connect(("dsmka.wintertoad.xyz", 587))
server_output = sckt.recv(2048)

def send_and_try(input, expected_output):
    sckt.send(f"{input}\r\n".encode())
    server_output = sckt.recv(2048)
    if (server_output.decode() != f"{expected_output}\r\n"):
        exit()

if (server_output.decode() != "220 dsmka.wintertoad.xyz ESMTP\r\n"):
    exit()

login = input("Login: ")
login_bytes = login.encode('ascii')
base64_login_bytes = base64.b64encode(login_bytes)
base64_login = base64_login_bytes.decode('ascii')

password = input("Haslo: ")
password_bytes = password.encode('ascii')
base64_password_bytes = base64.b64encode(password_bytes)
base64_password = base64_password_bytes.decode('ascii')

sender = input("Nadawca: ")
receiver = input("Odbiorca: ")
subj = input("Temat wiadomości: ")
msg = input("Wiadomość: ")

send_and_try("EHLO fedora", "250-dsmka.wintertoad.xyz\r\n250-PIPELINING\r\n250-SIZE 10240000\r\n250-ETRN\r\n250-AUTH PLAIN LOGIN\r\n250-AUTH=PLAIN LOGIN\r\n250-ENHANCEDSTATUSCODES\r\n250-8BITMIME\r\n250-DSN\r\n250 CHUNKING")
send_and_try("AUTH LOGIN", "334 VXNlcm5hbWU6")
send_and_try(base64_login, "334 UGFzc3dvcmQ6")
send_and_try(base64_password, "235 2.7.0 Authentication successful")
send_and_try(f"MAIL FROM: < {sender} >", "250 2.1.0 Ok")
send_and_try(f"RCPT TO: < {receiver}>", "250 2.1.5 Ok")
send_and_try("DATA", "354 End data with <CR><LF>.<CR><LF>")

sckt.send(f"To: <{receiver}>\r\n".encode())
sckt.send(f"From: <{sender}>\r\n".encode())
sckt.send(f"Subject: {subj}\r\n".encode())
sckt.send(f"""Content-Type: multipart/mixed; boundary=sep\r\n--sep\r\n{msg}\r\n--sep\r\nContent-Type: image/jpeg; name=\"yyy.jpeg\"\r\nContent-Disposition: attachment; filename=\"yyy.jpeg\"\r\nContent-Transfer-Encoding: base64\r\n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\r\n0b7dHoyUj24PIkbo46SqIVLCNaRwid7isifkNPko8hMVscGI8gi+SI0L4m32PlFj\r\nxlEnopyw/8QAJBEAAgIDAQACAQUBAAAAAAAAAAECEQMEIRIxQRMFEBQyUSL/2gAI\r\nAQMBAT8Axzsj/wBGDDZqQaSIKkJ0euj6ZIm1H7M0eiRTIa3kUPJryo1I3FMqkfDE\r\nxE4m1Ezx6fX7KaY16NbDbRqqopC+Bq2KJXCZsfBs/wBhscjEkyce8NBf6KXlH8lr\r\nhjy+hPlksyRLMmbErXDZb9MXThjYsfs1MXkljfmyUJWa8H9kuRNjI0+EZyZK3Hps\r\nRtjVFmOfTTj7MWKkJJxo/An0jFRJu+IyYPZ/Gonj8xNiHScRrooJPh+ntcsi1XDH\r\nCLXSSikLy30morqEOCo2FS4fijP+xuJQlwXT7NTJ4ow5fSMcuGSfBTdkrZB9L4bT\r\nSR7Ss3JepEY2hIjPyzSyekYp8GvSIYrJ4qKpk8lI28/B7HyZ53Ih8EXR8s05eaox\r\nS4mQlZHI4jyOXyToyyNyUbpmR+XwUXN2yKaVCZfTUdmPI1wxZSE0yU0jLmMuZm3K\r\nU58I4nLrHFQPypDifZprhVEcnkhnonsGTK2O5H4FJ2xYVRnwN/A9aVkj7NIkS4Rb\r\nJNlkF+yHFHiP+H//2Q==\r\n--sep--\r\n""".encode())
sckt.send(".\r\n".encode())
server_output = sckt.recv(2048)
server_output.decode()
if (not server_output.decode().startswith("250")):
    exit()
send_and_try("QUIT", "221 2.0.0 Bye")

